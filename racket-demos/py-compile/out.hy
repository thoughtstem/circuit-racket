(import express) (import tslib) (import (tslib (*))) (defn update () (global state) (do (if (shake 20) (destroy-effect) False))) (defn setup () (global state) (do (do (setv (. state ["memory"] ["beam-start"]) False) state))) (defn destroy-effect () (global state) (do (flash (if True (, 255 0 0) "red") (if True (, 255 255 255) "white")) (flash (if True (, 255 165 0) "orange") (if True (, 255 255 0) "yellow")) (set-lights (if True (, 0 0 0) "black")))) (defn flash (c1 c2) (global state) (do (for (n (range 10)) (set-brightness (random.random)) (set-lights c1) (play-tone (+ 100 (* 300 (random.random))) 0.08) (set-lights c2) (play-tone (+ 100 (* 300 (random.random))) 0.08)))) (setup) (while True (if (not (= express.cpx.touch_A1 touch_A1_prev)) (if express.cpx.touch_A1 (do (if (. state ["memory"] ["beam-start"]) (do (play-riff (, (, 261.63 0.125) (, 293.66 0.125) (, 659.25 0.125) (, 698.46 0.125) (, 783.99 0.125) (, 880.0 0.125))) (for (n (range 10)) (set-light n (if True (, 0 0 0) "black")) (do (time.sleep 0.25) (express.cpx.pixels.show)))) False)))) (if (not (= express.cpx.touch_A3 touch_A3_prev)) (if express.cpx.touch_A3 (do (for (n (range 100)) (play-tone 0.05 (* 2 (+ 200 n))) (set-brightness (random.random)) (set-lights (if True (, 0 255 0) "green"))) (play-riff (, (, 261.63 0.125) (, 293.66 0.125) (, 659.25 0.125) (, 698.46 0.125) (, 783.99 0.125) (, 880.0 0.125))) (do (setv (. state ["memory"] ["beam-start"]) True) state)))) (if (not (= express.cpx.touch_A6 touch_A6_prev)) (if express.cpx.touch_A6 (do (for (n (range 10)) (pin-write board.A7 True) (play-tone 0.1 523.25) (pin-write board.A7 False) (play-tone 0.1 261.63))))) (if (not (= express.cpx.touch_A5 touch_A5_prev)) (if express.cpx.touch_A5 (do (set-lights (if True (, 255 0 0) "red")) (play-tone 0.1 392.0) (play-tone 0.1 523.25) (pin-write board.A7 False)))) (if (not (= express.cpx.touch_A4 touch_A4_prev)) (if express.cpx.touch_A4 (do (set-lights (if True (, 0 255 0) "green")) (play-tone 0.1 392.0) (play-tone 0.1 523.25) (pin-write board.A7 True)))) (update-buttons) (ir-receive) (hardware-update) (update))